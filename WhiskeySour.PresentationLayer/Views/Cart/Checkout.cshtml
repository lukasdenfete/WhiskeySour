@model WhiskeySour.Web.ViewModels.CheckoutViewModel

@{
    ViewData["Title"] = "Checkout";
}

<div class="container my-5">
    <h2 class="mb-4">Checkout</h2>

    <div class="row">
        <div class="col-md-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h4 class="mb-0">Shipping Details</h4>
                </div>
                <div class="card-body">
                    <form asp-action="PlaceOrder" asp-controller="Order" method="post" id="checkout-form">
                        
                        <div class="row g-3">
                            <div class="col-sm-6">
                                <div class="form-floating">
                                    <input asp-for="FirstName" class="form-control" placeholder="First Name" />
                                    <label asp-for="FirstName">First name</label>
                                    <span asp-validation-for="FirstName" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-sm-6">
                                <div class="form-floating">
                                    <input asp-for="LastName" class="form-control" placeholder="Last Name" />
                                    <label asp-for="LastName">Last name</label>
                                    <span asp-validation-for="LastName" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-floating">
                                    <input asp-for="Address" class="form-control" placeholder="Address" />
                                    <label asp-for="Address">Address</label>
                                    <span asp-validation-for="Address" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-5">
                                <div class="form-floating">
                                    <select asp-for="Country" class="form-select">
                                        <option value="">Choose...</option>
                                        <option value="Andorra">Andorra</option>
                                        <option value="Botswana">Botswana</option>
                                        <option value="El Salvador">El Salvador</option>
                                        <option value="Sweden">Sweden</option>
                                    </select>
                                    <label asp-for="Country">Country</label>
                                    <span asp-validation-for="Country" class="text-danger small"></span>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input asp-for="City" class="form-control" placeholder="City" />
                                    <label asp-for="City">City</label>
                                    <span asp-validation-for="City" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <h4 class="mb-3">Payment</h4>
                        <div class="my-3">
                            <div class="form-check">
                                <input asp-for="PaymentMethod" type="radio" class="form-check-input" value="credit" onchange="togglePaymentFields()" checked>
                                <label class="form-check-label" for="PaymentMethod">Credit card</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="PaymentMethod" type="radio" class="form-check-input" value="paypal" onchange="togglePaymentFields()">
                                <label class="form-check-label" for="PaymentMethod">PayPal</label>
                            </div>
                            <div class="form-check">
                                <input asp-for="PaymentMethod" type="radio" class="form-check-input" value="swish" onchange="togglePaymentFields()">
                                <label class="form-check-label" for="PaymentMethod">Swish</label>
                            </div>
                        </div>

                        <div id="payment-credit" class="payment-section">
                            <div class="row gy-3">
                                <div class="col-md-6">
                                    <label asp-for="CreditCardName" class="form-label">Name on card</label>
                                    <input asp-for="CreditCardName" class="form-control" />
                                    <small class="text-muted">Full name displayed on card</small>
                                    <span asp-validation-for="CreditCardName" class="text-danger d-block"></span>
                                </div>
        
                                <div class="col-md-6">
                                    <label asp-for="CreditCardNumber" class="form-label">Credit card number</label>
                                    <input asp-for="CreditCardNumber" class="form-control" placeholder="1234567812345678" maxlength="16" />
                                    <span asp-validation-for="CreditCardNumber" class="text-danger"></span>
                                </div>
        
                                <div class="col-md-3">
                                    <label asp-for="CreditCardExpiration" class="form-label">Expiration</label>
                                    <input asp-for="CreditCardExpiration" type="text" class="form-control" placeholder="MM/YY" maxlength="5" />
                                    <span asp-validation-for="CreditCardExpiration" class="text-danger"></span>
                                </div>
        
                                <div class="col-md-3">
                                    <label asp-for="CreditCardCvv" class="form-label">CVV</label>
                                    <input asp-for="CreditCardCvv" type="text" class="form-control" placeholder="123" maxlength="3" />
                                    <span asp-validation-for="CreditCardCvv" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div id="payment-paypal" class="payment-section d-none">
                            <div class="alert alert-info border-0 shadow-sm">
                                <i class="bi bi-paypal me-2"></i>You will be redirected to PayPal to complete your payment securely.
                            </div>
                        </div>

                        <div id="payment-swish" class="payment-section d-none">
                            <div class="col-md-6">
                                <label asp-for="SwishNumber" class="form-label">Swish Number</label>
                                <input asp-for="SwishNumber" class="form-control" placeholder="0701234567" disabled required />
                                <small class="text-muted">Enter the mobile number connected to Swish</small>
                                <span asp-validation-for="SwishNumber" class="text-danger d-block"></span>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm position-sticky border-0" style="top: 2rem;">
                <div class="card-header bg-light border-bottom-0">
                    <h5 class="mb-0">Order Summary</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush mb-3">
                        @if (Model.Cart?.Items != null)
                        {
                            foreach (var item in Model.Cart.Items)
                            {
                                <li class="list-group-item d-flex justify-content-between lh-sm px-0">
                                    <div>
                                        <h6 class="my-0">@item.Product.Name</h6>
                                        <small class="text-muted">Qty: @item.Quantity</small>
                                    </div>
                                    <span class="text-muted">@((item.Product.Price * item.Quantity).ToString("C"))</span>
                                </li>
                            }
                            <li class="list-group-item d-flex justify-content-between px-0 fw-bold border-top mt-2 pt-3">
                                <span>Total</span>
                                <span>@Model.Cart.TotalPrice.ToString("C")</span>
                            </li>
                        }
                    </ul>

                    <button type="submit" form="checkout-form" class="btn btn-dark w-100 btn-lg">
                        Place Order
                    </button>
                    
                    <div class="text-center mt-3">
                        <a asp-controller="Cart" asp-action="Index" class="text-decoration-none small text-muted">
                            <i class="bi bi-arrow-left me-1"></i>Back to cart
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            togglePaymentFields();
        });

        function togglePaymentFields() {
            const creditSection = document.getElementById('payment-credit');
            const paypalSection = document.getElementById('payment-paypal');
            const swishSection = document.getElementById('payment-swish');
            const sections = [creditSection, paypalSection, swishSection];
            const selectedMethod = document.querySelector('input[name="PaymentMethod"]:checked').value;

            sections.forEach(section => {
                if (section.id === 'payment-' + selectedMethod) {
                    section.classList.remove('d-none');
                    section.querySelectorAll('input').forEach(input => {
                        input.disabled = false;
                    });
                } else {
                    section.classList.add('d-none');
                    section.querySelectorAll('input').forEach(input => {
                        input.disabled = true;
                    });
                }
            });
        }
    </script>
}